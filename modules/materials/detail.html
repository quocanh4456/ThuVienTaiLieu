<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Chi ti·∫øt t√†i li·ªáu - EduPlatform</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <style>
        .preview-box { width: 100%; height: 600px; background: #f1f5f9; border-radius: 12px; display: flex; align-items: center; justify-content: center; border: 1px solid #e2e8f0; margin-top: 20px; }
        .info-box { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); height: fit-content; }
        .btn-download { display: block; width: 100%; padding: 12px; background: var(--success-color); color: white; text-align: center; border-radius: 8px; text-decoration: none; font-weight: bold; margin-bottom: 20px; cursor: pointer; border: none; }
        .btn-download:hover { opacity: 0.9; }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="logo">EduPlatform</div>
        <ul class="nav-links">
            <li><a href="../dashboard/index.html"><span class="nav-icon">üìä</span> T·ªïng quan</a></li>
            <li><a href="index.html" class="active"><span class="nav-icon">üìö</span> Th∆∞ vi·ªán</a></li>
            <li><a href="../quiz/index.html"><span class="nav-icon">üìù</span> B√†i h·ªçc & Quiz</a></li>
        </ul>
    </nav>

    <main class="main-content" style="grid-template-columns: 2fr 1fr;">
        <div>
            <a href="index.html" style="color: #64748b; text-decoration: none;">‚Üê Quay l·∫°i th∆∞ vi·ªán</a>
            <h1 id="docTitle" style="margin-top: 15px;">ƒêang t·∫£i d·ªØ li·ªáu...</h1>
            
            <div class="preview-box" id="previewArea">
                <p>ƒêang t·∫£i b·∫£n xem tr∆∞·ªõc...</p>
            </div>
        </div>

        <div class="info-box">
            <a id="btnDownload" href="#" target="_blank" class="btn-download">‚¨á T·∫£i xu·ªëng ngay</a>
            
            <p><strong>Ch·ªß ƒë·ªÅ:</strong> <span id="docTopic">...</span></p>
            <p><strong>Lo·∫°i file:</strong> <span class="tag" id="docType">...</span></p>
            <p><strong>Ng√†y ƒëƒÉng:</strong> <span id="docDate">...</span></p>
            <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">
            <p><strong>M√¥ t·∫£:</strong></p>
            <p id="docDesc" style="color: #64748b; font-size: 0.95rem; line-height: 1.5;">...</p>
        </div>
    </main>

    <script>
        // 1. L·∫•y ID t·ª´ tr√™n thanh ƒë·ªãa ch·ªâ
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        if (!id) {
            alert("Kh√¥ng t√¨m th·∫•y ID t√†i li·ªáu!");
            window.location.href = 'index.html';
        }

        // 2. G·ªçi API ƒë·ªÉ l·∫•y d·ªØ li·ªáu
        async function loadDetail() {
            try {
                const res = await fetch(`http://localhost:3000/api/materials/${id}`);
                const data = await res.json();
                
                // V√¨ API tr·∫£ v·ªÅ m·∫£ng [ {id:1, title:...} ] n√™n ta l·∫•y ph·∫ßn t·ª≠ s·ªë 0
                const m = data[0]; 

                if (!m) {
                    document.getElementById('docTitle').innerText = "T√†i li·ªáu kh√¥ng t·ªìn t·∫°i!";
                    return;
                }

                // 3. Hi·ªÉn th·ªã th√¥ng tin l√™n m√†n h√¨nh
                document.getElementById('docTitle').innerText = m.title;
                document.getElementById('docTopic').innerText = m.topic;
                document.getElementById('docType').innerText = m.type ? m.type.toUpperCase() : 'FILE';
                document.getElementById('docDesc').innerText = m.description || "Kh√¥ng c√≥ m√¥ t·∫£.";
                document.getElementById('docDate').innerText = new Date(m.created_at).toLocaleDateString('vi-VN');

                // 4. X·ª≠ l√Ω ƒë∆∞·ªùng d·∫´n file
                let fileUrl = m.link;
                // N·∫øu link ch∆∞a c√≥ http://localhost:3000 th√¨ th√™m v√†o
                if (fileUrl && !fileUrl.startsWith('http')) {
                    fileUrl = `http://localhost:3000/${fileUrl}`;
                }
                document.getElementById('btnDownload').href = fileUrl;

                // 5. X·ª≠ l√Ω Preview (Xem tr∆∞·ªõc)
                const preview = document.getElementById('previewArea');
                const type = m.type ? m.type.toLowerCase() : '';

                if (type === 'pdf') {
                    preview.innerHTML = `<iframe src="${fileUrl}" width="100%" height="100%" style="border:none;"></iframe>`;
                } else if (['jpg', 'png', 'jpeg', 'gif'].includes(type)) {
                    preview.innerHTML = `<img src="${fileUrl}" style="max-width:100%; max-height:100%; object-fit:contain;">`;
                } else if (type === 'video' || type === 'mp4') {
                    preview.innerHTML = `<video controls width="100%" height="100%"><source src="${fileUrl}" type="video/mp4"></video>`;
                } else {
                    preview.innerHTML = `
                        <div style="text-align:center;">
                            <p style="font-size:3rem;">üìÇ</p>
                            <p>ƒê·ªãnh d·∫°ng <b>${type}</b> kh√¥ng h·ªó tr·ª£ xem tr∆∞·ªõc.</p>
                            <p>Vui l√≤ng b·∫•m n√∫t <b>T·∫£i xu·ªëng</b> ƒë·ªÉ xem.</p>
                        </div>
                    `;
                }

            } catch (error) {
                console.error(error);
                alert("L·ªói t·∫£i d·ªØ li·ªáu: " + error.message);
            }
        }

        loadDetail();
    </script>
</body>
</html>